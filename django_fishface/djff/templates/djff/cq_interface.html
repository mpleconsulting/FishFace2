{% extends "djff/base.html" %}

{% block localscript %}
    <script type="text/javascript">
        $(document).ready(function(){

            function debug_print(print_this) {
                $('#debug_print_area').append(print_this);
            }

            {% for cjt in cjts %}
            $('#CJT_' + {{ cjt.id }}).data('cjt_id', {{ cjt.id }});
            {% endfor %}

            $('#b-ton').click( function() {
                debug_print('<br />');
                $('.job_queue_item').each( function () {
                    debug_print(' ' + $(this).attr('data-cjt'));
                });
            });

            $('#capturejob_queue').sortable({
                update: function(event, ui) {
                debug_print('<br />' + $('#capturejob_queue').sortable('toArray').toString());
                },
                revert: true,
                stop: function(event, ui) {
                    if (ui.item.hasClass("fresh_cjt")) {
                        ui.item.removeClass("fresh_cjt");
                        ui.item.addClass("job_queue_item")
                    }
                },
                beforeStop: function(event, ui) {
                    newItem = ui.item
                    helperId = ui.helper.attr('data-cjt')
                },
                receive: function(event, ui) {
                    $(newItem).attr('id', 'CJT_' + helperId)
                }
            });

            $(".fresh_cjt").draggable({
                connectToSortable: "#sortable_list",
                helper: "clone",
                revert: "invalid"
            });

        });
    </script>

    <style type="text/css">
	</style>


{% endblock %}

{% block subtitle %}Capture Queue{% endblock %}

{% block content %}
    <ul class="queue_block" id="capturejob_queue">
        <li class="ui-state-default">one</li>
        <li class="ui-state-default">two</li>
    </ul>

    <form action="{% url 'djff:cq_interface' %}" method="post">
        {% csrf_token %}
        <input type="button" value="b-ton" id="b-ton">
        <input type="submit" value="Save">
    </form>

    <div id="debug_print_area">STUFF</div>
{% endblock %}

{% block preview_area %}
    <ul class="queue_block" id="cjt_list">
    {% for cjt in cjts %}
        <li class="fresh_cjt" id="CJT_{{ cjt.id }}" data-cjt="{{ cjt.id }}">{{ cjt.startup_delay }}s, then
            every {{ cjt.interval }}s for {{ cjt.duration }}s
        ({{ cjt.voltage }}V, {{ cjt.current }}A)</li>
    {% endfor %}
    </ul>


{% endblock %}