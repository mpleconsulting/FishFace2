{% extends "djff/base.html" %}
{% load staticfiles %}
{% load djff_filters %}

{% block subtitle %}Capture Imagery{% endblock %}



{% block content %}
    <em>Experiment Name:</em><br />
    <strong>
        <a href="{% url 'djff:experiment_rename' xp.id %}">
            {{ xp.experiment_name }}
        </a>
    </strong>

    {% if not cal_images %}
        <div class="boxed bad">
            <p>The first image captured for an experiment must be
        a <em>calibration image</em>.  No fish should be in the flume,
        but otherwise the configuration of the lighting, etc.
        should be exactly as it will be during the data capture.</p>

            <p>When you're ready to capture a calibration image, check the
        box below and click on the button.</p>
        </div>
    {% endif %}
    <div class="boxed">
    <form method="post"
          action="{% url 'djff:experiment_capturer' %}">
        {% csrf_token %}

        <input type="hidden" value="0" name="voltage">
        <input type="hidden" value="True" name="is_cal_image">
        <input type="checkbox" value="True" name="cal_ready">
        Ready to capture calibration image (no fish):
        <input type="hidden" value="{{ xp.id }}" name="xp_id">
        <input type="submit" value="Capture a calibration image" />
    </form>

    {% if cal_images %}
        <p>Calibration images:</p>
        {% for img in cal_images %}
            {{ img.linked_inline_image|replace_width:"20"|mark_safe }}
        {% endfor %}
    {% else %}
        <p>No cal images.</p>
    {% endif %}

    </div>

    <div class="boxed">
    {% if cal_images and capture_job_templates %}
    <ol>
    {% for cjt in capture_job_templates %}
        <li>
        <form method="post" action="{% url 'djff:run_capturejob' xp.id cjt.id %}">
        {% csrf_token %}
            Duration: {{ cjt.duration }},
            Interval: {{ cjt.interval }},
            Voltage: {{ cjt.voltage }}
        <input type="submit" value="Run this capture job" />
        </form>
        </li>
    {% endfor %}
    </ol>
    {% elif not cal_images %}
        Please capture a calibration image before viewing the capture jobs.
    {% endif %}

    </div>


    {% if data_images %}
        <h1>DATA</h1>
        {% for img in data_images %}
            {{ img.linked_inline_bullet|mark_safe }}
        {% endfor %}
    {% else %}
        <p>No data images.</p>
    {% endif %}

{% endblock %}

{% block preview_area %}
{% endblock %}