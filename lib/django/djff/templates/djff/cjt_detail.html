{% extends "djff/base.html" %}

{% block subtitle %}Capture Job Template{% endblock %}

{% block localscript %}

  <script type="text/javascript">
    $(document).ready(function() {
    // changed input#delete... to button#delete...
    $('button#delete_button').on('click', function() {
      if ($('#confirm_delete').prop('checked')) {
        console.log('deletion!');
        $.ajax({
          type: 'POST',
          url: "{% url 'djff:cjt_delete' context.id %}",  // set by inline javascript on the main page
          data: {},
          complete: function (data, status, jqXHR) {
            window.location.href="{% url 'djff:cjt_index' %}";
          },
          dataType: 'json'
        });
        }
      });

      $("input#id_duration, input#id_interval, input#id_startup_delay").on('blur', function() {
        var element = $(this);
        element.val(window.ff.text_to_seconds(element.val()));
      });

      window.ff.enable_disable_startup_delay = function() {
        var startup_delay = $('input#id_startup_delay');
        if (Number($(this).val()) <= 0) {
         window.ff.cached_startup_delay = Number(startup_delay.val());
         console.log('disabling after cached delay: ' + window.ff.cached_startup_delay);
         startup_delay.val(0);
         startup_delay.attr('disabled', 'true');
        } else {
         if (window.ff.cached_startup_delay > 0) {
             startup_delay.val(window.ff.cached_startup_delay);
             delete window.ff.cached_startup_delay;
         }
         startup_delay.removeAttr('disabled');
        }
      };

      $("input#id_interval").on('change', window.ff.enable_disable_startup_delay);

      // changed input#id... to button#id...
      $("button#id_submit_button").on('click', function() {
        $('input#id_startup_delay').removeAttr('disabled');
      });

      $("input#id_interval").change();

    });
  </script>

{% endblock %}

{% block content %}

  <h4>Editing Capture Job Template</h4>

  <form action="{% url 'djff:cjt_detail' context.id %}" method="post">

{% csrf_token %}

    <div class="form-group">
      <label for="id_voltage">Voltage</label>
      <input type="number" class="form-control" id="id_voltage" placeholder="Voltage" name="voltage" step="0.5" value="{{ context.voltage }}">
    </div>
    <div class="form-group">
      <label for="id_current">Max Current</label>
      <input type="number" class="form-control" id="id_current" placeholder="Max Current" name="current" step="1.0" value="{{ context.current }}">
    </div>
    <div class="form-group">
      <label for="id_startup_delay">Delay between Power and Capture</label>
      <input type="number" class="form-control" id="id_startup_delay" placeholder="Delay between Power and Capture" name="startup_delay" step="any" value="{{ context.startup_delay }}">
    </div>
    <div class="form-group">
      <label for="id_duration">Duration to Capture</label>
      <input type="number" class="form-control" id="id_duration" placeholder="Duration to Capture" name="duration" step="5.0" value="{{ context.duration }}">
    </div>
    <div class="form-group">
      <label for="id_interval">Interval between Images</label>
      <input type="number" class="form-control" id="id_interval" placeholder="Interval between Images" name="interval" step="1.0" value="{{ context.interval }}">
    </div>

    <div class="form-group">
      <label for="id_description">Description (optional)</label>
      <textarea class="form-control" id="id_description" placeholder="Description (optional)" name="description" rows="10">{{ context.description }}</textarea>
    </div>

    <div class="form-group">
      <button type="submit" class="btn btn-success btn-lg btn-block" id="id_submit_button">Save</button>
    </div>

    <div class="form-group">
      <div class="container-fluid">
        <div class="row">
          <div class="col-xs-offset-7 col-xs-3">
            <button type="button" class="btn btn-default btn-sm btn-block" id="delete_button">delete</button>
          </div>
          <div class="col-xs-1">
            <div class="checkbox-inline">
              <label>
                <input type="checkbox" id="confirm_delete" value="">
                confirm delete
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p class="alert alert-warning" role="alert">Note: To run the flume for a certain amount of time without capturing any data, use a 0 value for the interval. <em>For example, you could set the voltage to 0V, the duration to 900s, and the interval to 0 to give the fish a 15-minute rest.</em></p>

{% endblock %}
